<%= render "home/navbar" %>

  <main>

    <div class="col-md-8 ">
      <div class="box">
        <h4>portfolio chart</h4>
        <%= render 'portfolio_chart', stocks: @stocks, stock_quote: StockQuote::Stock %>

      <div id="portfolio"></div>
      </div>
    </div>

    <div class="col-md-4 ">
      <div class="box">
        <h4>ADD NEW STOCK</h4>
        <%= render 'form', stock: @new_stock %>
      </div>
    </div>

    <div class="col-md-12 ">
      <div class="box">
        <h4>PORTFOLIO Details</h4>
        <table class="table table-striped table-bordered portfolio_table">
          <thead>
            <tr>
              <th>Company Name</th>
              <th>Ticker</th>
              <th>Current Price</th>
              <th>Company Worth</th>
              <th>Quantity</th>
              <th>Sector</th>
              <th>Total Value</th>
              <th>Options</th>
            </tr>
          </thead>

          <tbody>
            <% @stocks.each do |stock| %>
              <% if stock.user_id == current_user.id %>
                <% begin %>
                  <% @stock_quote = StockQuote::Stock.quote(stock.ticker) %>
                  <tr class="dashboard_table">
                    <td class="no_padding_row"><%= link_to @stock_quote.name, stock %></td>
                    <td class="no_padding_row"><%= link_to stock.ticker, stock %></td>
                    <td class="padding_row"><%= @stock_quote.l %></td>
                    <td class="padding_row"><%= @stock_quote.mc %></td>
                    <td class="padding_row"><%= stock.quantity %></td>
                    <td class="padding_row"><%= @stock_quote.sname %></td>
                    <td class="padding_row">
                      <% total = stock.quantity.to_i * @stock_quote.l.to_f %>
                      <%= total.round(2) %>
                    </td>
                    <td class="no_padding_row">
                        <%= link_to edit_stock_path(stock), class: 'icons' do%>
                          <i class="fa fa-pencil-square-o" aria-hidden="true"></i>
                        <% end %>
                        <%= link_to stock, method: :delete, class: 'icons' do %>
                          <i class="fa fa-trash" aria-hidden="true"></i>
                        <% end %>
                    </td>
                  </tr>
                <% rescue StandardError => e %>
                <%= e.message %>
                  <tr>
                    <td><%= link_to "Error", stock %></td>
                    <td><%= "Error" %></td>
                    <td><%= "Error" %></td>
                    <td><%= "Error" %></td>
                  </tr>
                  <% next %>
                <% end %>
              <% end %>
            <% end %>
          </tbody>
        </table>

      </div>
    </div>


    <div class="col-md-6 ">
      <div class="box">
        <h4>QUOTE LOOKUP</h4>
        <div class="user_profile search_box_area dashboard_search">
          <%= form_tag root_path, :method => "POST" do %>
            <%= text_field_tag 'id', nil, placeholder: "Enter Companyname, Ticker or Symbol", size: 50 %>
            <%= button_to do %>
               <i class="fa fa-search" aria-hidden="true"></i>
            <% end %>
          <% end %>

          <% if @stock %>
            <div class="col-md-8 col-md-offset-2 stock_info_box">
              <%= render '/home/stockInfo' %>
            </div>
          <% elsif @nothing %>
            <%= @nothing %>
          <% end %>

          <% if @error %>
           <%= @error %>
          <% end %>
        </div>
      </div>
    </div>

    <div class="col-md-6 ">
      <div class="box">
        <h4>Empty Box</h4>
        <p>Lorem Ipsum is simply dummy text of the printing and typesetting industry. Lorem Ipsum has been the industry's standard dummy text ever since the 1500s, when an unknown </p>
      </div>
    </div>

  </main>
</div>
